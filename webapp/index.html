<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Магазин постельного белья</title>
  <link rel="stylesheet" href="/public/styles.css">
</head>
<body>
  <div id="app">
    <h1>Магазин постельного белья</h1>
    <div id="loader">Загрузка...</div>
    <div id="error" style="display: none; color: red;"></div>
    <div id="products"></div>
  </div>

  <script>
    const app = document.getElementById("app");
    const loader = document.getElementById("loader");
    const errorDiv = document.getElementById("error");
    const productsDiv = document.getElementById("products");

    const fetchProducts = async () => {
      try {
        const response = await fetch("/api/products", { timeout: 5000 });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const products = await response.json();
        return products;
      } catch (err) {
        throw new Error("Не удалось загрузить товары: " + err.message);
      }
    };

    const renderProducts = (products) => {
      productsDiv.innerHTML = products.length
        ? products
            .map(
              (product) => `
                <div class="product-card">
                  <h2>${product.name}</h2>
                  <p>Цена: ${product.price} ₽</p>
                  <p>Категория: ${product.category}</p>
                  <p>В наличии: ${product.stock}</p>
                  ${product.image_url ? `<img src="${product.image_url}" alt="${product.name}" />` : ""}
                  <p>${product.description}</p>
                  <p>Теги: ${product.tags?.join(", ") || "Нет тегов"}</p>
                </div>
              `
            )
            .join("")
        : "<p>Товары отсутствуют</p>";
    };

    const init = async () => {
      try {
        const products = await fetchProducts();
        loader.style.display = "none";
        renderProducts(products);
      } catch (err) {
        loader.style.display = "none";
        errorDiv.style.display = "block";
        errorDiv.textContent = err.message;
      }
    };

    init();
  </script>
</body>
</html>