<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–∞–≥–∞–∑–∏–Ω –ø–æ—Å—Ç–µ–ª—å–Ω–æ–≥–æ –±–µ–ª—å—è</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.3.1/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.3.1/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.25.6/Babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card:hover {
      transform: scale(1.03);
      transition: transform 0.2s;
    }
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      const [products, setProducts] = useState([]);
      const [sortBy, setSortBy] = useState('relevance');
      const [search, setSearch] = useState('');
      const [category, setCategory] = useState('all');
      const [cart, setCart] = useState([]);
      const [error, setError] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        fetch('/api/products')
          .then(res => {
            if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
            return res.json();
          })
          .then(data => {
            setProducts(data);
            setLoading(false);
          })
          .catch(err => {
            setError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤: ' + err.message);
            setLoading(false);
          });
      }, []);

      const filteredProducts = products
        .filter(p => p.name.toLowerCase().includes(search.toLowerCase()))
        .filter(p => category === 'all' || p.category === category)
        .sort((a, b) => {
          if (sortBy === 'price') return a.price - b.price;
          if (sortBy === 'popularity') return b.stock - a.stock;
          return 0;
        });

      const categories = ['all', ...new Set(products.map(p => p.category))];

      const addToCart = (product) => {
        setCart([...cart, product]);
      };

      if (error) {
        return (
          <div className="container mx-auto p-4 text-center text-red-500">
            <p className="text-lg font-semibold">{error}</p>
            <button
              className="mt-4 bg-blue-500 text-white p-2 rounded"
              onClick={() => window.location.reload()}
            >
              –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
          </div>
        );
      }

      if (loading) {
        return (
          <div className="container mx-auto p-4 flex justify-center items-center h-screen">
            <div className="loader"></div>
          </div>
        );
      }

      return (
        <div className="container mx-auto p-4 max-w-4xl">
          <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">
            üõí –ú–∞–≥–∞–∑–∏–Ω –ø–æ—Å—Ç–µ–ª—å–Ω–æ–≥–æ –±–µ–ª—å—è
          </h1>
          
          <div className="mb-6">
            <input
              type="text"
              placeholder="üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..."
              className="w-full p-3 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              value={search}
              onChange={(e) => setSearch(e.target.value)}
            />
          </div>

          <div className="flex flex-col sm:flex-row gap-4 mb-6">
            <select
              className="p-3 border rounded-lg shadow-sm flex-1"
              value={sortBy}
              onChange={(e) => setSortBy(e.target.value)}
            >
              <option value="relevance">–ü–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏</option>
              <option value="price">–ü–æ —Ü–µ–Ω–µ</option>
              <option value="popularity">–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</option>
            </select>

            <select
              className="p-3 border rounded-lg shadow-sm flex-1"
              value={category}
              onChange={(e) => setCategory(e.target.value)}
            >
              {categories.map(cat => (
                <option key={cat} value={cat}>
                  {cat === 'all' ? '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' : cat}
                </option>
              ))}
            </select>
          </div>

          {products.length === 0 && (
            <p className="text-center text-gray-600 text-lg">
              üòî –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
            </p>
          )}

          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredProducts.map(product => (
              <div
                key={product.id}
                className="card bg-white border rounded-lg shadow-md p-4"
              >
                <img 
                  src={product.image_url || 'https://via.placeholder.com/150'} 
                  alt={product.name} 
                  className="w-full h-48 object-cover rounded-md mb-4" 
                />
                <h3 className="text-lg font-semibold text-gray-800">
                  {product.name}
                </h3>
                <p className="text-gray-600 text-sm mb-2">
                  {product.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}
                </p>
                <p className="text-lg font-bold text-blue-600">
                  {product.price} ‚ÇΩ
                </p>
                <p className="text-sm text-gray-500">
                  –í –Ω–∞–ª–∏—á–∏–∏: {product.stock}
                </p>
                <p className="text-sm text-gray-500 mb-4">
                  –¢–µ–≥–∏: {product.tags.length ? product.tags.join(", ") : '–ù–µ—Ç —Ç–µ–≥–æ–≤'}
                </p>
                <button 
                  className="w-full bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 transition-colors"
                  onClick={() => addToCart(product)}
                >
                  üõçÔ∏è –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                </button>
              </div>
            ))}
          </div>

          {cart.length > 0 && (
            <div className="mt-8 p-6 bg-white border rounded-lg shadow-md">
              <h2 className="text-xl font-bold text-gray-800 mb-4">
                üõí –ö–æ—Ä–∑–∏–Ω–∞ ({cart.length})
              </h2>
              <ul className="space-y-2">
                {cart.map((item, index) => (
                  <li key={index} className="text-gray-700">
                    {item.name} - {item.price} ‚ÇΩ
                  </li>
                ))}
              </ul>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>